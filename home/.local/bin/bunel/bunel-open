#!/bin/sh


help="
usage:
-h : Show help and exit with code 0
-a : Select something for the active window
-p : Select prefab
-s : Select scene
"

prefab=
scene=
active_window=

while getopts ":apsh" opt; do
    case ${opt} in
        h ) echo "$help"
            exit 0
            ;;
        s ) scene="--"
            ;;
        p ) prefab="--"
            ;;
        a ) active_window="--"
            ;;
        \? ) echo "$help"
            exit 0
             ;;
    esac
done



if [ -n "$active_window" ]
then
    project=$(xdotool getactivewindow getwindowname | grep -Po 'Unity - \K[^ ]*')
else
    projects=$(fd -td -I Assets -d2 | cut -d'/' -f1 | rg IdleGame)
    project=$(echo "$projects" | dmenu -b -p "Select project:")
fi


fd -tf -I -e prefab . ~/idlegame/IdleGame/Assets | grep -Po 'Assets/.*$' > /tmp/prefab.file

selection=$(rev < prefab.file | cut -d '/' -f1 | rev | dmenu -b -p "target:" -l 10 -i)
target=$(grep -e "/$selection$" /tmp/prefab.file)
[ -n "$project" ] && [ -n "$target" ] && bunel "$project" open-prefab "$target"
rm -f /tmp/prefab.file
